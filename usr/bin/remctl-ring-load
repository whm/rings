#!/usr/bin/perl
#
# remctl-ring-load -- remctl wrapper for ring-load
#
# Written by Bill MacAllister <bill@ca-zephyr.org>
# Copyright (c) 2024 Bill MacAllister <bill@ca-zephyr.org>

use Getopt::Long;
use Rings::Common;
use strict;

my $opt_help;

##############################################################################
# Main Routine
##############################################################################

# -- get options
GetOptions('help' => \$opt_help);

my $action = shift;

if ($action == 'help' || $opt_help) {
    system('ring-load --help');
    exit;
}

my $id      = shift;
my %id_list = get_id_list();
if (!$id_list{$id}) {
    print("ERROR: unknown ID $id\n");
    print("INFO: Valid IDs:\n");
    for my $i (sort keys %id_list) {
        print("    $i\n");
        exit 1;
    }
}
my $ring_conf = "/etc/rings/${id}.conf";
get_config($ring_conf);

# Setup for accessing afs
my $kstart;
if ($CONF->krb_keytab) {
    $kstart = 'k5start -f ' . $CONF->krb_keytab;
    $kstart .= ' ' . $CONF->krb_principal;
    $kstart .= ' -t';
    $kstart .= ' -- ';
}

my $args = join(' ', @ARGV);
my $cmd  = "$kstart ring_load " . $args;
system($cmd);

exit;
